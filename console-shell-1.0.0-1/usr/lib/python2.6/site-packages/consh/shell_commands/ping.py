# -*- coding: utf-8 -*-

__capability__ = 6

def ping(cmd, *args, **argv):
    """
...     
_n      ping
_f      ping  [-LRUbdfnqrvVaA] [-c count] [-i interval] [-w deadline]
_f      [-p pattern] [-s packetsize] [-t ttl] [-I interface or address]
_f      [-M mtu discovery hint] [-S sndbuf]
_f      [ -T timestamp option ] [ -Q tos ] [hop1 ...] destination
    """
    import os
    context = argv["context"]
    
    def count(num):
        if str(num) == str(int(num)):
            if num < 0:
                context.write("%s: bad number of packets to transmit." % cmd)
            else:
                return num
        else:
            context.write("%s: can't set unicast time-to-live: Unknown host" % cmd)
            return

    ping_p = {"-c":count}

    def isipaddress(ip):
        import socket
        try:
            ipa = socket.gethostbyname(ip)
            return ipa
        except:
            context.write("ping: unknown host %s" % ip)
            return None

    def doping(cmd, sign, sign_param, ipaddress):
        if sign in ping_p.keys():
            # #
            pass
        else:
            context.write("connect: Unknown host")
            return 
        
	if ping_p[sign](sign_param):
            # #
            pass
        else:
            return 
        if isipaddress(ipaddress):
            ip = isipaddress(ipaddress)
        else:
            return
        try:
            os.system(str(cmd) + " " + str(sign) + " " + str(sign_param) + " " + str(ip))
        except:
            context.write("has some errors in ping command")
            return 

    length = len(args)
    
    if length == 0:
        helpinfo = context.resolver.get_func_doc(getattr(context.resolver.get_module(cmd), cmd))
        helpinfo_format = helpinfo["format"].rstrip()
        helpinfo_format = helpinfo_format.lstrip()
        if helpinfo_format == "":
            return
        context.write(helpinfo_format)

    elif length < 3:
        cmd_real = context.resolver.has_command(args[0], cmd)
        if cmd_real != None:
            cmds = cmd.split()
            cmd_n = "_".join(cmds)
            modulename = cmd_n + "_" + cmd_real
            module = context.resolver.get_module(modulename)
            func = getattr(module, modulename)
            func(cmd + " " + cmd_real, context = context)
        else:
            doping(cmd, "-c", 4, args[0])

    else:
	if args[1] == "0":
	    os.system(str(cmd) + " " + str(args[2]))
	else:
            doping(cmd, args[0], args[1], args[2])
